package eu.stratosphere.sopremo.sdaa11.clustering.initial;

import java.io.IOException;

import org.junit.Test;

import eu.stratosphere.sopremo.io.JsonParser;
import eu.stratosphere.sopremo.sdaa11.Annotator;
import eu.stratosphere.sopremo.sdaa11.clustering.Point;
import eu.stratosphere.sopremo.sdaa11.json.AnnotatorNodes;
import eu.stratosphere.sopremo.testing.SopremoTestPlan;
import eu.stratosphere.sopremo.type.IJsonNode;
import eu.stratosphere.sopremo.type.ObjectNode;

public class SequentialClusteringTest {

	@Test
	public void testSequentialClustering() throws IOException {
		final SequentialClustering clustering = new SequentialClustering();
		clustering.setMaxRadius(200);
		clustering.setMaxSize(200);

		final SopremoTestPlan plan = new SopremoTestPlan(clustering);

		final String testPointsJsonString = "[{\"id\":\"point000\",\"rowsum\":0,\"values\":[\"a\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"l\",\"m\",\"n\"]},{\"id\":\"point001\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"g\",\"h\",\"i\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point002\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"g\",\"h\",\"j\",\"k\",\"l\",\"m\",\"o\"]},{\"id\":\"point003\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"o\"]},{\"id\":\"point004\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"h\",\"i\",\"j\",\"k\",\"l\",\"n\",\"o\"]},{\"id\":\"point005\",\"rowsum\":0,\"values\":[\"d\",\"e\",\"f\",\"g\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point006\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"e\",\"g\",\"h\",\"i\",\"k\",\"l\",\"m\",\"n\"]},{\"id\":\"point007\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"i\",\"k\",\"l\",\"m\",\"n\"]},{\"id\":\"point008\",\"rowsum\":0,\"values\":[\"d\",\"e\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\",\"m\",\"o\"]},{\"id\":\"point009\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"h\",\"i\",\"j\",\"n\",\"o\"]},{\"id\":\"point010\",\"rowsum\":0,\"values\":[\"a\",\"d\",\"e\",\"f\",\"h\",\"i\",\"k\",\"l\",\"n\",\"o\"]},{\"id\":\"point011\",\"rowsum\":0,\"values\":[\"d\",\"e\",\"f\",\"h\",\"i\",\"j\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point012\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"g\",\"h\",\"i\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point013\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"e\",\"h\",\"i\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point014\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"g\",\"i\",\"j\",\"l\",\"m\"]},{\"id\":\"point015\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"d\",\"f\",\"g\",\"j\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point016\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"d\",\"e\",\"f\",\"h\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point017\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"i\",\"n\",\"o\"]},{\"id\":\"point018\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"k\"]},{\"id\":\"point019\",\"rowsum\":0,\"values\":[\"d\",\"e\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"o\"]},{\"id\":\"point020\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"e\",\"f\",\"g\",\"h\",\"i\",\"k\",\"l\",\"n\"]},{\"id\":\"point021\",\"rowsum\":0,\"values\":[\"c\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"n\"]},{\"id\":\"point022\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"g\",\"j\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point023\",\"rowsum\":0,\"values\":[\"b\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point024\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point025\",\"rowsum\":0,\"values\":[\"a\",\"e\",\"f\",\"g\",\"i\",\"j\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point026\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"h\",\"l\",\"m\",\"n\"]},{\"id\":\"point027\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"e\",\"g\",\"h\",\"i\",\"j\",\"l\",\"m\",\"o\"]},{\"id\":\"point028\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"d\",\"e\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\"]},{\"id\":\"point029\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"o\"]},{\"id\":\"point030\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"g\",\"h\",\"i\",\"l\",\"m\",\"n\"]},{\"id\":\"point031\",\"rowsum\":0,\"values\":[\"c\",\"d\",\"f\",\"h\",\"i\",\"j\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point032\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"e\",\"g\",\"i\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point033\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\",\"m\"]},{\"id\":\"point034\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"e\",\"f\",\"i\",\"j\",\"k\",\"l\",\"m\"]},{\"id\":\"point035\",\"rowsum\":0,\"values\":[\"b\",\"d\",\"e\",\"f\",\"g\",\"h\",\"j\",\"k\",\"m\",\"n\"]},{\"id\":\"point036\",\"rowsum\":0,\"values\":[\"c\",\"d\",\"e\",\"g\",\"h\",\"i\",\"k\",\"l\",\"m\",\"o\"]},{\"id\":\"point037\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"d\",\"e\",\"f\",\"i\",\"j\",\"k\",\"n\",\"o\"]},{\"id\":\"point038\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"e\",\"f\",\"g\",\"j\",\"k\",\"l\",\"n\",\"o\"]},{\"id\":\"point039\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"f\",\"g\",\"h\",\"i\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point040\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"g\",\"i\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point041\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"g\",\"i\",\"j\",\"m\",\"n\",\"o\"]},{\"id\":\"point042\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\"]},{\"id\":\"point043\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"d\",\"g\",\"i\",\"j\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point044\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"f\",\"g\",\"i\",\"j\",\"k\",\"l\",\"n\",\"o\"]},{\"id\":\"point045\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"e\",\"f\",\"g\",\"i\",\"j\",\"k\",\"l\"]},{\"id\":\"point046\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"i\",\"j\",\"k\",\"l\",\"m\",\"o\"]},{\"id\":\"point047\",\"rowsum\":0,\"values\":[\"a\",\"d\",\"e\",\"f\",\"h\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point048\",\"rowsum\":0,\"values\":[\"b\",\"e\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point049\",\"rowsum\":0,\"values\":[\"b\",\"d\",\"f\",\"h\",\"i\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point050\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"e\",\"f\",\"g\",\"i\",\"j\",\"k\",\"o\"]},{\"id\":\"point051\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"g\",\"h\",\"i\",\"k\",\"m\",\"o\"]},{\"id\":\"point052\",\"rowsum\":0,\"values\":[\"a\",\"d\",\"f\",\"g\",\"h\",\"i\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point053\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"m\",\"o\"]},{\"id\":\"point054\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"f\",\"g\",\"h\",\"i\",\"m\",\"n\"]},{\"id\":\"point055\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"i\",\"j\",\"k\",\"n\"]},{\"id\":\"point056\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"d\",\"e\",\"g\",\"h\",\"i\",\"j\",\"l\",\"n\"]},{\"id\":\"point057\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"f\",\"g\",\"i\",\"j\",\"l\",\"n\"]},{\"id\":\"point058\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"f\",\"g\",\"i\",\"l\",\"m\",\"n\"]},{\"id\":\"point059\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"n\",\"o\"]},{\"id\":\"point060\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"g\",\"h\",\"i\",\"m\",\"o\"]},{\"id\":\"point061\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"f\",\"h\",\"i\",\"j\",\"l\",\"o\"]},{\"id\":\"point062\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"g\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\"]},{\"id\":\"point063\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"j\",\"k\",\"l\",\"n\"]},{\"id\":\"point064\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"d\",\"e\",\"f\",\"g\",\"h\",\"k\",\"m\",\"o\"]},{\"id\":\"point065\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"e\",\"h\",\"i\",\"j\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point066\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"g\",\"i\",\"j\",\"k\",\"n\",\"o\"]},{\"id\":\"point067\",\"rowsum\":0,\"values\":[\"d\",\"f\",\"g\",\"h\",\"i\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point068\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"h\",\"i\",\"j\",\"k\",\"n\",\"o\"]},{\"id\":\"point069\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"i\",\"l\",\"m\",\"n\"]},{\"id\":\"point070\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"d\",\"f\",\"g\",\"h\",\"i\",\"k\",\"l\",\"n\"]},{\"id\":\"point071\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"n\",\"o\"]},{\"id\":\"point072\",\"rowsum\":0,\"values\":[\"b\",\"d\",\"e\",\"g\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\"]},{\"id\":\"point073\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"j\",\"n\"]},{\"id\":\"point074\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"g\",\"h\",\"k\",\"l\",\"m\"]},{\"id\":\"point075\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"h\",\"i\",\"j\",\"m\",\"n\"]},{\"id\":\"point076\",\"rowsum\":0,\"values\":[\"d\",\"e\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"n\",\"o\"]},{\"id\":\"point077\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"i\",\"j\",\"l\"]},{\"id\":\"point078\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"h\",\"i\",\"k\",\"l\",\"m\",\"o\"]},{\"id\":\"point079\",\"rowsum\":0,\"values\":[\"c\",\"d\",\"e\",\"f\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\"]},{\"id\":\"point080\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\",\"n\"]},{\"id\":\"point081\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"m\",\"n\"]},{\"id\":\"point082\",\"rowsum\":0,\"values\":[\"b\",\"d\",\"e\",\"f\",\"g\",\"i\",\"j\",\"k\",\"n\",\"o\"]},{\"id\":\"point083\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"g\",\"h\",\"j\",\"k\",\"l\",\"n\"]},{\"id\":\"point084\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"f\",\"h\",\"j\",\"k\",\"l\",\"n\"]},{\"id\":\"point085\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"i\",\"l\",\"o\"]},{\"id\":\"point086\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"i\",\"l\",\"n\",\"o\"]},{\"id\":\"point087\",\"rowsum\":0,\"values\":[\"c\",\"e\",\"f\",\"h\",\"i\",\"j\",\"k\",\"m\",\"n\",\"o\"]},{\"id\":\"point088\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"e\",\"f\",\"g\",\"h\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point089\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"m\",\"o\"]},{\"id\":\"point090\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"e\",\"f\",\"g\",\"i\",\"k\",\"m\",\"n\"]},{\"id\":\"point091\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"g\",\"j\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point092\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"g\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point093\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"d\",\"e\",\"g\",\"i\",\"j\",\"k\",\"n\",\"o\"]},{\"id\":\"point094\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"e\",\"h\",\"i\",\"j\",\"l\",\"n\",\"o\"]},{\"id\":\"point095\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"d\",\"e\",\"g\",\"i\",\"k\",\"l\",\"m\",\"n\"]},{\"id\":\"point096\",\"rowsum\":0,\"values\":[\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"l\"]},{\"id\":\"point097\",\"rowsum\":0,\"values\":[\"a\",\"c\",\"d\",\"f\",\"g\",\"h\",\"j\",\"k\",\"l\",\"o\"]},{\"id\":\"point098\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"f\",\"h\",\"j\",\"l\",\"m\",\"n\",\"o\"]},{\"id\":\"point099\",\"rowsum\":0,\"values\":[\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"i\",\"j\",\"m\",\"n\"]}]";
		final JsonParser parser = new JsonParser(testPointsJsonString);

		while (!parser.checkEnd())
			plan.getInput(0).add(
					this.createAnnotatedPoint(parser.readValueAsTree()));

		// TODO pass expected output

		plan.run();

		// Instead just check the cluster sizes (2x2)

		int count = 0;
		for (final IJsonNode node : plan.getActualOutput(0)) {
			final ObjectNode cluster = (ObjectNode) node;
			System.out.println(cluster);
			// Assert.assertEquals(2, ((IArrayNode)
			// cluster.get("points")).size());
			count++;
		}
		// Assert.assertEquals(2, count);
	}

	private IJsonNode createAnnotatedPoint(final Point point) {
		return this.createAnnotatedPoint(point.write(null));
	}

	private IJsonNode createAnnotatedPoint(final IJsonNode pointNode) {
		final ObjectNode annotatedValue = new ObjectNode();
		AnnotatorNodes.annotate(annotatedValue, Annotator.ANNOTATION_VALUE,
				pointNode);
		return annotatedValue;
	}

}
