<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>eu.stratosphere</groupId>
		<artifactId>ozone</artifactId>
		<version>0.2-ozone</version>
	</parent>

	<artifactId>stratosphere-dist</artifactId>
	<name>stratosphere-dist</name>
	<packaging>pom</packaging>

	<dependencies>
		<!-- BINARIES -->
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-common</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-clustermanager</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-examples</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-hdfs</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-s3</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-management</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-profiling</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-queuescheduler</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-server</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>nephele-visualization</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>pact-common</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>pact-compiler</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>pact-clients</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>pact-examples</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>eu.stratosphere</groupId>
			<artifactId>pact-runtime</artifactId>
			<version>${project.version}</version>
		</dependency>
	</dependencies>

	<!-- See main pom.xml for explanation of profiles -->
	<profiles>
		<profile>
			<id>hadoop_yarn</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<dependencies>
				<dependency>
					<groupId>eu.stratosphere</groupId>
					<artifactId>pact-hbase</artifactId>
					<version>${project.version}</version>
				</dependency>
			</dependencies>
		</profile>
		
		<profile>
			<id>hadoop_v1</id>
			<dependencies>
        		<!-- No extra dependencies: pact-hbase is currently not compatible with Hadoop v1 -->
			</dependencies>
		</profile>
	</profiles>

	<build>
		<plugins>
			<plugin>
				<artifactId>maven-assembly-plugin</artifactId>
				<executions>
					<execution>
						<id>generate-package</id>
						<phase>package</phase>
						<goals>
							<goal>single</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<descriptors>
						<descriptor>src/main/assemblies/bin.xml</descriptor>
					</descriptors>
				</configuration>
			</plugin>
			<plugin>
				<artifactId>jdeb</artifactId>
				<groupId>org.vafer</groupId>
				<version>1.0.1</version>
				<executions>
					<execution>
						<phase>package</phase>
						<goals>
							<goal>jdeb</goal>
						</goals>
						<configuration>
							<deb>${project.build.directory}/${project.artifactId}_${project.version}.deb</deb>
							<controlDir>${basedir}/src/deb/control</controlDir>
							<dataSet>
								<data>
									<src>${basedir}/src/deb/bin/nephele-jobmanager</src>
									<type>file</type>
									<mapper>
										<type>perm</type>
										<prefix>/etc/init.d</prefix>
										<user>root</user>
										<group>root</group>
										<filemode>0755</filemode>
									</mapper>
								</data>
								<data>
									<src>${basedir}/src/deb/bin/nephele-taskmanager</src>
									<type>file</type>
									<mapper>
										<type>perm</type>
										<prefix>/etc/init.d</prefix>
										<user>root</user>
										<group>root</group>
										<filemode>0755</filemode>
									</mapper>
								</data>
								<data>
									<src>${basedir}/src/deb/bin/pact-webfrontend</src>
									<type>file</type>
									<mapper>
										<type>perm</type>
										<prefix>/etc/init.d</prefix>
										<user>root</user>
										<group>root</group>
										<filemode>0755</filemode>
									</mapper>
								</data>
								<data>
									<src>${project.build.directory}/${project.artifactId}-${project.version}-bin/stratosphere-${project.version}/bin</src>
									<type>directory</type>
									<mapper>
										<type>perm</type>
										<prefix>/usr/share/${project.artifactId}/bin</prefix>
										<user>root</user>
										<group>root</group>
										<filemode>0755</filemode>
									</mapper>
								</data>
								<data>
									<src>${project.build.directory}/${project.artifactId}-${project.version}-bin/stratosphere-${project.version}/docs</src>
									<type>directory</type>
									<mapper>
										<type>perm</type>
										<prefix>/usr/share/${project.artifactId}/docs</prefix>
										<user>root</user>
										<group>root</group>
									</mapper>
								</data>
								<data>
									<src>${project.build.directory}/${project.artifactId}-${project.version}-bin/stratosphere-${project.version}/examples</src>
									<type>directory</type>
									<mapper>
										<type>perm</type>
										<prefix>/usr/share/${project.artifactId}/examples</prefix>
										<user>root</user>
										<group>root</group>
									</mapper>
								</data>
								<data>
									<src>${project.build.directory}/${project.artifactId}-${project.version}-bin/stratosphere-${project.version}/lib</src>
									<type>directory</type>
									<mapper>
										<type>perm</type>
										<prefix>/usr/share/${project.artifactId}/lib</prefix>
										<user>root</user>
										<group>root</group>
									</mapper>
								</data>
								<data>
									<src>${project.build.directory}/${project.artifactId}-${project.version}-bin/stratosphere-${project.version}/lib_clients</src>
									<type>directory</type>
									<mapper>
										<type>perm</type>
										<prefix>/usr/share/${project.artifactId}/lib_clients</prefix>
										<user>root</user>
										<group>root</group>
									</mapper>
								</data>
								<data>
									<src>${project.build.directory}/${project.artifactId}-${project.version}-bin/stratosphere-${project.version}/resources</src>
									<type>directory</type>
									<mapper>
										<type>perm</type>
										<prefix>/usr/share/${project.artifactId}/resources</prefix>
										<user>root</user>
										<group>root</group>
									</mapper>
								</data>
								<data>
									<src>${project.build.directory}/${project.artifactId}-${project.version}-bin/stratosphere-${project.version}/conf</src>
									<type>directory</type>
									<mapper>
										<type>perm</type>
										<prefix>/etc/${project.artifactId}/conf</prefix>
										<user>root</user>
										<group>root</group>
									</mapper>
								</data>
								<data>
									<type>template</type>
									<paths>
										<path>/var/log/${project.artifactId}</path>
									</paths>
								</data>
								<data>
									<type>link</type>
									<linkName>/usr/share/${project.artifactId}/conf</linkName>
									<linkTarget>/etc/${project.artifactId}/conf</linkTarget>
									<symlink>true</symlink>
								</data>
								<data>
									<type>link</type>
									<linkName>/usr/share/${project.artifactId}/log</linkName>
									<linkTarget>/var/log/${project.artifactId}</linkTarget>
									<symlink>true</symlink>
								</data>
							</dataSet>
						</configuration>
					</execution>
				</executions>
			</plugin>

		</plugins>
	</build>
</project>
